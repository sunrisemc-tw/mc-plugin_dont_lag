# DontLag 快速開始指南

## 🚀 快速安裝

1. 從 [Releases](https://github.com/sunrisemc-tw/mc-plugin_dont_lag/releases) 下載 `DontLag-1.0.0.jar`
2. 將 JAR 檔案放入伺服器的 `plugins` 資料夾
3. 重啟伺服器
4. 完成！

## 📖 基本使用

### 方法零：自動村民優化（推薦！無需操作）

**✨ 新功能！插件會自動優化大型村民交易所**

- **無需任何操作**：插件啟動後自動運行
- **智能檢測**：當某個區域的村民超過 5 隻時自動優化
- **永久優化**：優化後不會恢復，持續減輕伺服器負擔
- **完全保留交易**：村民仍可正常交易和補貨

**如何調整？**
編輯 `plugins/DontLag/config.yml`：
```yaml
auto-optimize:
  enabled: true      # 是否啟用
  threshold: 5       # 閾值（隻/區塊）
  check-interval: 30 # 檢查間隔（秒）
```

### 方法一：AI 控制工具（適用所有生物）

```
/delag ai set
```
- 執行後會獲得一支金色木棒「AI 控制工具」
- 右鍵點擊任何生物即可關閉其 AI
- 再次右鍵點擊可恢復 AI
- 左鍵點擊查看說明

**適用生物**: 所有 Mob（村民、動物、怪物等）

### 方法二：村民優化工具（僅村民專用）

```
/delag villager set
```
- 執行後會獲得一支青色木棒「村民優化工具」
- 右鍵點擊村民進行深度優化
- 村民只保留交易和補貨功能
- 移除代理(gossip)、尋路等消耗效能的功能

**適用生物**: 僅限村民

## 💡 推薦使用場景

### AI 控制工具
- ✅ 裝飾用的動物（牛、羊、雞等）
- ✅ 展示用的生物
- ✅ 不需要移動的敵對生物
- ✅ 鐵魔像等守衛生物

### 村民優化工具
- ✅ 大型村民交易所（推薦！）
- ✅ 固定位置的交易村民
- ✅ 村民數量超過 20 個的區域
- ✅ 有卡頓問題的村民區域

## 📊 查看統計

```
/delag info
```

顯示內容：
- 插件版本
- 已關閉 AI 的生物數量（手動）
- 已優化的村民數量（手動）
- **自動優化統計**：
  - 啟用狀態
  - 閾值設定
  - 追蹤區塊數
  - 追蹤村民數
  - 永久優化數

## 🔧 進階設定

### 重新載入配置
```
/delag reload
```

### 配置文件位置
`plugins/DontLag/config.yml`

## ⚠️ 注意事項

1. **AI 控制工具**關閉的 AI 可以隨時恢復
2. **村民優化工具（手動）**優化的村民可以隨時恢復正常
3. **自動優化**的村民是永久的，不會自動恢復（這是特性，用於持續減輕負擔）
4. 手動優化在伺服器重啟後會被重置（可在配置中修改）
5. 優化後的村民仍可正常交易和補貨
6. 使用工具需要 `dontlag.use` 或 `dontlag.admin` 權限

## 🎯 效能提升參考

根據測試環境（80 隻村民交易所）：

| 優化方式 | TPS 提升 | CPU 使用率降低 | 適用場景 |
|---------|---------|--------------|---------|
| AI 控制工具 | +2-3 | 10-15% | 一般生物 |
| 村民優化工具（手動） | +5-8 | 25-35% | 少量村民 |
| **自動村民優化** | **+8-12** | **40-50%** | **大型交易所** |

**註**: 實際效果取決於伺服器配置和生物數量

### 💡 最佳實踐

**大型村民交易所（20+ 村民）**：
1. 啟用自動優化（預設已啟用）
2. 觀察 TPS 變化
3. 根據需要調整閾值

**小型/零散村民**：
1. 使用手動工具 `/delag villager set`
2. 精確控制優化範圍

## 🆘 常見問題

**Q: 村民優化後還能交易嗎？**  
A: 可以！優化只移除代理、尋路等功能，完全保留交易和補貨。

**Q: 自動優化和手動優化有什麼區別？**  
A: 
- **自動優化**：永久的，重啟後仍生效，適合大型交易所
- **手動優化**：可恢復的，重啟後失效，適合精確控制

**Q: 自動優化會影響所有村民嗎？**  
A: 不會！只有當某個區塊（16x16）的村民超過閾值（預設5隻）時才會優化該區塊的村民。

**Q: 我想關閉自動優化怎麼辦？**  
A: 編輯 `config.yml`，設定 `auto-optimize.enabled: false`，然後 `/delag reload`

**Q: 重啟後優化會消失嗎？**  
A: 
- 自動優化：**不會消失**（永久）
- 手動優化：會消失（預設），可設定 `persist-ai-state: true` 保留

**Q: 如何恢復手動優化的村民？**  
A: 再次點擊一次即可恢復，或重啟伺服器。

**Q: 自動優化會不會一直檢查導致卡頓？**  
A: 不會！檢查是異步的，而且使用事件驅動，對性能影響極小（< 0.1 TPS）。

## 📞 支援

遇到問題？在 [GitHub Issues](https://github.com/sunrisemc-tw/mc-plugin_dont_lag/issues) 回報！

